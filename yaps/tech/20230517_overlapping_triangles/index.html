<html lang=en><head><meta charset=UTF-8><link rel=stylesheet href=/css/index.css><link rel="shortcut icon" type=image/png href=/img/favicon.png><title>moom</title>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><div id=container><div id=title>tech</div><article id=blog><div class=blog-title>Point on triangle algorithms</div><div class=blog-date><time datetime=2023-05-18T11:16:00+08:00>May 18, 2023</time></div><div class=blog-body><p>A game I'm working on requires me to check if a point is overlapped by a triangle.
Being a dumb engineer who can't come up wiith his own algorithm, google gave me 3 algorithms.
Here I'm just going to share the algorithms and their performances.</p><p>Parametric:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#c1abea>b32_t</span> <span style=color:#00b1f7>parametric</span>(<span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp0</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp1</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp2</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>pt</span>) {
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>denominator</span> <span style=color:#c7bf54>=</span> (<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>) <span style=color:#c7bf54>+</span> 
</span></span><span style=display:flex><span>                     <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>+</span> 
</span></span><span style=display:flex><span>                     <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>t1</span> <span style=color:#c7bf54>=</span> (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span>) <span style=color:#c7bf54>+</span> 
</span></span><span style=display:flex><span>            <span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>-</span> 
</span></span><span style=display:flex><span>            <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>/</span> <span style=color:#c1abea>denominator</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>t2</span> <span style=color:#c7bf54>=</span> (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span>) <span style=color:#c7bf54>+</span> 
</span></span><span style=display:flex><span>            <span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span>(<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>-</span> 
</span></span><span style=display:flex><span>            <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span><span style=color:#c7bf54>*</span><span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>/</span> <span style=color:#c7bf54>-</span><span style=color:#c1abea>denominator</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>s</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>t1</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>t2</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c678dd>return</span> <span style=color:#d19a66>0</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#c1abea>t1</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>t1</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#d19a66>0</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#c1abea>t2</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>t2</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>s</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Dot Product:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#c1abea>b32_t</span> <span style=color:#00b1f7>dot_product</span>(<span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp0</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp1</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp2</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>pt</span>) {
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>vec0</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span>, <span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span>);      
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>vec1</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>, <span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span>);      
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>vec2</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>, <span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>);      
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>n0</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span>, <span style=color:#c7bf54>-</span><span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span>);
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>n1</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span>, <span style=color:#c7bf54>-</span><span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>);
</span></span><span style=display:flex><span>  <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>n2</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_set</span>(<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>, <span style=color:#c7bf54>-</span><span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>b32_t</span> <span style=color:#c1abea>side0</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_dot</span>(<span style=color:#c1abea>n0</span>,<span style=color:#c1abea>vec0</span>) <span style=color:#c7bf54>&lt;</span> <span style=color:#d19a66>0.f</span>;
</span></span><span style=display:flex><span>  <span style=color:#c1abea>b32_t</span> <span style=color:#c1abea>side1</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_dot</span>(<span style=color:#c1abea>n1</span>,<span style=color:#c1abea>vec1</span>) <span style=color:#c7bf54>&lt;</span> <span style=color:#d19a66>0.f</span>;
</span></span><span style=display:flex><span>  <span style=color:#c1abea>b32_t</span> <span style=color:#c1abea>side2</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>v2f_dot</span>(<span style=color:#c1abea>n2</span>,<span style=color:#c1abea>vec2</span>) <span style=color:#c7bf54>&lt;</span> <span style=color:#d19a66>0.f</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c678dd>return</span> <span style=color:#c1abea>side0</span> <span style=color:#c7bf54>==</span> <span style=color:#c1abea>side1</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>side0</span> <span style=color:#c7bf54>==</span> <span style=color:#c1abea>side2</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Barycentric:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#c1abea>b32_t</span> <span style=color:#00b1f7>barycentric</span>(<span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp0</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp1</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>tp2</span>, <span style=color:#c1abea>v2f_t</span> <span style=color:#c1abea>pt</span>) {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>denominator</span> <span style=color:#c7bf54>=</span> ((<span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>                     (<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>+</span> (<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>                     (<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>a</span> <span style=color:#c7bf54>=</span> ((<span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>           (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>+</span> (<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp1</span>.<span style=color:#c1abea>x</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>           (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>)) <span style=color:#c7bf54>/</span> <span style=color:#c1abea>denominator</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>b</span> <span style=color:#c7bf54>=</span> ((<span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>y</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>           (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>) <span style=color:#c7bf54>+</span> (<span style=color:#c1abea>tp0</span>.<span style=color:#c1abea>x</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>x</span>)<span style=color:#c7bf54>*</span>
</span></span><span style=display:flex><span>           (<span style=color:#c1abea>pt</span>.<span style=color:#c1abea>y</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>tp2</span>.<span style=color:#c1abea>y</span>)) <span style=color:#c7bf54>/</span> <span style=color:#c1abea>denominator</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c1abea>f32_t</span> <span style=color:#c1abea>c</span> <span style=color:#c7bf54>=</span> <span style=color:#d19a66>1.f</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>a</span> <span style=color:#c7bf54>-</span> <span style=color:#c1abea>b</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#c678dd>return</span> <span style=color:#d19a66>0.f</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#c1abea>a</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>a</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1.f</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#d19a66>0.f</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#c1abea>b</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>b</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1.f</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#d19a66>0.f</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#c1abea>c</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c1abea>c</span> <span style=color:#c7bf54>&lt;=</span> <span style=color:#d19a66>1.f</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Of course, these could be written better but I'm just writing it as the algorithm suggested without too much care.
I didn't care about which one was faster until one day I ran a scene with tons of triangles on my Surface Go, which I eventually experienced some slowdown.
That's when I decided to profile them.</p><p>These are the results on my Surface Book 2, with MSVC compiler:</p><table><thead><tr><th>Algorithm</th><th>Unoptimized</th><th>-O2</th></tr></thead><tbody><tr><td>Barycentric</td><td>~72 cycles</td><td>~27 cycles</td></tr><tr><td>Dot Product</td><td>~262 cycles</td><td>~27 cycles</td></tr><tr><td>Parametric</td><td>~100 cycles</td><td>~37 cycles</td></tr></tbody></table><p>It was interesting to see the results.
At first I was surprised to see the Dot Product version so slow because it was what others claimed to be fast, but thankfully after optimization, it ended up being (one of the) fastest.</p></div></div></div></body></html>